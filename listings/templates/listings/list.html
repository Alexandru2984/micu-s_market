{% extends "base.html" %}
{% load static %}

{% block title %}Toate Anunțurile - Micu's Market{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/listings.css' %}">
<link rel="stylesheet" href="{% static 'css/buttons.css' %}">
<link rel="stylesheet" href="{% static 'css/spectacular-elements.css' %}">
<style>
/* ANIMAȚII PENTRU BUTOANE SPECTACULOASE */
@keyframes pulse {
    0%, 100% { 
        transform: scale(1); 
        opacity: 1; 
    }
    50% { 
        transform: scale(1.2); 
        opacity: 0.8; 
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-4px);
    }
    60% {
        transform: translateY(-2px);
    }
}

@keyframes shake {
    0%, 100% { 
        transform: translateX(0); 
    }
    10%, 30%, 50%, 70%, 90% { 
        transform: translateX(-3px); 
    }
    20%, 40%, 60%, 80% { 
        transform: translateX(3px); 
    }
}

/* GLOW EFFECTS */
#searchButton::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
}

#searchButton:hover::before {
    left: 100%;
}

#filterButton::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
}

#filterButton:hover::before {
    left: 100%;
}

#resetButton::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
}

#resetButton:hover::before {
    left: 100%;
}
</style>
{% endblock %}

{% block content %}
<div class="listings-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'listings:home' %}">
                        <i class="fas fa-home"></i>
                        Acasă
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'listings:list' %}">Anunțuri</a>
                </li>
                {% if current_category %}
                    <li class="breadcrumb-item active">
                        <i class="fas {{ current_category.icon|default:'fa-folder' }}"></i>
                        {{ current_category.name }}
                    </li>
                {% elif search_query %}
                    <li class="breadcrumb-item active">
                        <i class="fas fa-search"></i>
                        Căutare: "{{ search_query }}"
                    </li>
                {% else %}
                    <li class="breadcrumb-item active">
                        <i class="fas fa-list"></i>
                        Toate anunțurile
                    </li>
                {% endif %}
            </ol>
        </nav>

        <!-- Header cu titlu și filtre -->
        <div class="listings-header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-layer-group"></i>
                    {% if search_query %}
                        Rezultate pentru "{{ search_query }}"
                    {% elif current_category %}
                        {{ current_category.name }}
                    {% else %}
                        Toate Anunțurile
                    {% endif %}
                </h1>
                <div class="header-stats">
                    <span class="results-count">
                        <i class="fas fa-chart-bar"></i>
                        {{ page_obj.paginator.count }} anunțuri găsite
                    </span>
                    {% if search_query or current_category or current_city %} 
                        <a href="{% url 'listings:list' %}" class="reset-filters">
                            <i class="fas fa-refresh"></i>
                            Resetează filtrele
                        </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="header-actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'listings:create' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> 
                        Adaugă anunț
                    </a>
                {% else %}
                    <a href="{% url 'account_login' %}" class="btn btn-outline">
                        <i class="fas fa-sign-in-alt"></i>
                        Conectează-te pentru a adăuga anunț
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Search Bar -->
        <div class="quick-search-section">
            <div class="quick-search-container">
                <form method="get" class="quick-search-form">
                    <div class="search-input-group">
                        <i class="fas fa-search search-icon" id="searchIcon"></i>
                        <input type="text" name="search" placeholder="Caută anunțuri..." 
                               value="{{ search_query }}" id="searchInput">
                        {% if current_category_slug %}
                            <input type="hidden" name="category" value="{{ current_category_slug }}">
                        {% endif %}
                        {% if current_city %}
                            <input type="hidden" name="city" value="{{ current_city }}">
                        {% endif %}
                        {% if sort_by %}
                            <input type="hidden" name="sort" value="{{ sort_by }}">
                        {% endif %}
                    </div>
                    <button type="submit" id="searchBtn">
                        <i class="fas fa-search"></i>
                        Caută
                    </button>
                </form>
                
                {% if search_query or current_category or current_city %}
                    <div class="active-filters">
                        <span class="filters-label">Filtre active:</span>
                        {% if search_query %}
                            <span class="filter-tag">
                                <i class="fas fa-search"></i>
                                "{{ search_query }}"
                                <a href="?{% if current_category_slug %}category={{ current_category_slug }}&{% endif %}{% if current_city %}city={{ current_city }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="remove-filter">×</a>
                            </span>
                        {% endif %}
                        {% if current_category %}
                            <span class="filter-tag">
                                <i class="fas fa-tag"></i>
                                {{ current_category.name }}
                                <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if current_city %}city={{ current_city }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="remove-filter">×</a>
                            </span>
                        {% endif %}
                        {% if current_city %}
                            <span class="filter-tag">
                                <i class="fas fa-map-marker-alt"></i>
                                {{ current_city }}
                                <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if current_category_slug %}category={{ current_category_slug }}&{% endif %}{% if sort_by %}sort={{ sort_by }}{% endif %}" class="remove-filter">×</a>
                            </span>
                        {% endif %}
                        <a href="{% url 'listings:list' %}" class="clear-all-filters">
                            <i class="fas fa-times"></i>
                            Șterge toate
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Layout principal -->
        <div class="listings-layout">
            <!-- Sidebar filtre -->
            <aside class="filters-sidebar">
                <div class="filters-card">
                    <div class="filters-header">
                        <h3><i class="fas fa-sliders-h"></i> Filtrează rezultatele</h3>
                    </div>
                    
                    <form method="get" class="filters-form" id="filtersForm">
                        <!-- Căutare -->
                        <div class="filter-group">
                            <label for="search" class="filter-label">
                                <i class="fas fa-search"></i>
                                Caută în anunțuri
                            </label>
                            <div class="input-wrapper">
                                <input type="text" id="search" name="search" class="filter-input" 
                                       placeholder="Ex: iPhone, Samsung, laptop..." value="{{ search_query }}">
                                <div class="input-border"></div>
                            </div>
                        </div>
                        
                        <!-- Categoria -->
                        <div class="filter-group">
                            <label for="category" class="filter-label">
                                <i class="fas fa-tags"></i>
                                Categoria
                            </label>
                            <div class="select-wrapper">
                                <select id="categoryDropdown" name="category">
                                    <option value="">🏷️ Toate categoriile</option>
                                    {% for category in categories %}
                                        <option value="{{ category.slug }}" 
                                            {% if current_category_slug == category.slug %}selected{% endif %}>
                                            {% if category.icon %}{{ category.icon|safe }}{% endif %} {{ category.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                        </div>
                        
                        <!-- Prețul -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-euro-sign"></i>
                                Intervalul de preț
                            </label>
                            <div class="price-range">
                                <div class="price-input-group">
                                    <span class="price-label" style="font-size: 12px; color: #10b981; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">De la</span>
                                    <input type="number" name="min_price" class="price-input" 
                                           placeholder="0" value="{{ min_price }}"
                                           style="padding: 12px 16px;
                                                  border: 3px solid #e5e7eb;
                                                  border-radius: 15px;
                                                  font-size: 16px;
                                                  font-weight: 700;
                                                  background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%);
                                                  transition: all 0.3s ease;
                                                  text-align: center;
                                                  color: #10b981;
                                                  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.1);"
                                           onfocus="this.style.borderColor='#10b981'; this.style.background='#ffffff'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 10px 25px rgba(16, 185, 129, 0.2)';"
                                           onblur="this.style.borderColor='#e5e7eb'; this.style.background='linear-gradient(135deg, #ffffff 0%, #f0fff4 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.1)';">
                                    <span class="currency" style="font-size: 12px; color: #10b981; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">RON</span>
                                </div>
                                <div class="price-separator" 
                                     style="color: #10b981;
                                            font-size: 24px;
                                            font-weight: bold;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            width: 50px;
                                            height: 50px;
                                            background: linear-gradient(135deg, #f0fff4, #e6fffa);
                                            border-radius: 50%;
                                            border: 3px solid #10b981;
                                            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.2);
                                            animation: pulse 2s infinite;">
                                    <i class="fas fa-arrows-alt-h"></i>
                                </div>
                                <div class="price-input-group">
                                    <span class="price-label" style="font-size: 12px; color: #10b981; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">Până la</span>
                                    <input type="number" name="max_price" class="price-input" 
                                           placeholder="999999" value="{{ max_price }}"
                                           style="padding: 12px 16px;
                                                  border: 3px solid #e5e7eb;
                                                  border-radius: 15px;
                                                  font-size: 16px;
                                                  font-weight: 700;
                                                  background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%);
                                                  transition: all 0.3s ease;
                                                  text-align: center;
                                                  color: #10b981;
                                                  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.1);"
                                           onfocus="this.style.borderColor='#10b981'; this.style.background='#ffffff'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 10px 25px rgba(16, 185, 129, 0.2)';"
                                           onblur="this.style.borderColor='#e5e7eb'; this.style.background='linear-gradient(135deg, #ffffff 0%, #f0fff4 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.1)';">
                                    <span class="currency" style="font-size: 12px; color: #10b981; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">RON</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Orașul -->
                        <div class="filter-group">
                            <label for="city" class="filter-label">
                                <i class="fas fa-map-marker-alt"></i>
                                Orașul
                            </label>
                            <div class="input-wrapper">
                                <input type="text" id="city" name="city" class="filter-input" 
                                       placeholder="Ex: București, Cluj, Timișoara..." value="{{ current_city }}"
                                       style="width: 100%;
                                              padding: 16px 20px;
                                              border: 3px solid #e5e7eb;
                                              border-radius: 20px;
                                              font-size: 16px;
                                              font-weight: 500;
                                              background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                                              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                                              color: #374151;
                                              box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.9);"
                                       onfocus="this.style.borderColor='#ef4444'; this.style.background='#ffffff'; this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 35px rgba(239, 68, 68, 0.15), 0 5px 15px rgba(0, 0, 0, 0.05)';"
                                       onblur="this.style.borderColor='#e5e7eb'; this.style.background='linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.08)';">
                                <div class="input-border"></div>
                            </div>
                        </div>
                        
                        <!-- Sortarea -->
                        <div class="filter-group">
                            <label for="sort" class="filter-label">
                                <i class="fas fa-sort"></i>
                                Sortează după
                            </label>
                            <div class="select-wrapper">
                                <select id="sortDropdown" name="sort">
                                    <option value="-created_at" {% if sort_by == '-created_at' %}selected{% endif %}>
                                        🕒 Cele mai noi
                                    </option>
                                    <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>
                                        ⏰ Cele mai vechi
                                    </option>
                                    <option value="price" {% if sort_by == 'price' %}selected{% endif %}>
                                        💰 Preț crescător
                                    </option>
                                    <option value="-price" {% if sort_by == '-price' %}selected{% endif %}>
                                        💸 Preț descrescător
                                    </option>
                                    <option value="title" {% if sort_by == 'title' %}selected{% endif %}>
                                        🔤 Titlu A-Z
                                    </option>
                                </select>
                                <i class="fas fa-chevron-down select-arrow"></i>
                            </div>
                        </div>
                        
                        <div class="filter-actions">
                            <button type="submit" id="filterBtn">
                                <i class="fas fa-search"></i>
                                <span>Filtrează</span>
                                <div class="btn-loader">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                            </button>
                            <a href="{% url 'listings:list' %}" id="resetBtn">
                                <i class="fas fa-eraser"></i>
                                <span>Resetează</span>
                            </a>
                        </div>
                    </form>
                </div>
            </aside>
            
            <!-- Conținutul principal -->
            <main class="listings-main">
                {% if page_obj %}
                    <!-- Grila cu anunțuri -->
                    <div class="listings-grid">
                        {% for listing in page_obj %}
                            <a href="{% url 'listings:detail' listing.slug %}" class="listing-card">
                                <div class="listing-image">
                                    {% if listing.images.first %}
                                        <img src="{{ listing.images.first.image.url }}" alt="{{ listing.title }}">
                                    {% else %}
                                        <div class="no-image">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    {% endif %}
                                    
                                    {% if listing.is_featured %}
                                        <div class="featured-badge">
                                            <i class="fas fa-star"></i> Recomandat
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="listing-content">
                                    <h3>{{ listing.title }}</h3>
                                    <p class="price">{{ listing.price }} RON</p>
                                    <p class="location">
                                        <i class="fas fa-map-marker-alt"></i>
                                        {{ listing.city }}{% if listing.county %}, {{ listing.county }}{% endif %}
                                    </p>
                                    
                                    <div class="listing-meta">
                                        <span class="category">{{ listing.category.name }}</span>
                                        <span class="date">{{ listing.created_at|date:"d.m.Y" }}</span>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                    
                    <!-- Paginare -->
                    {% if page_obj.has_other_pages %}
                        <div class="pagination">
                            {% if page_obj.has_previous %}
                                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category_slug %}&category={{ current_category_slug }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if current_city %}&city={{ current_city }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="btn btn-outline">
                                    <i class="fas fa-angle-double-left"></i> Prima
                                </a>
                                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category_slug %}&category={{ current_category_slug }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if current_city %}&city={{ current_city }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="btn btn-outline">
                                    <i class="fas fa-chevron-left"></i> Anterior
                                </a>
                            {% endif %}
                            
                            <span class="page-info">
                                Pagina {{ page_obj.number }} din {{ page_obj.paginator.num_pages }}
                            </span>
                            
                            {% if page_obj.has_next %}
                                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category_slug %}&category={{ current_category_slug }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if current_city %}&city={{ current_city }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="btn btn-outline">
                                    Următorul <i class="fas fa-chevron-right"></i>
                                </a>
                                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_category_slug %}&category={{ current_category_slug }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if current_city %}&city={{ current_city }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}" 
                                   class="btn btn-outline">
                                    Ultima <i class="fas fa-angle-double-right"></i>
                                </a>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                {% else %}
                    <!-- Stare goală -->
                    <div class="no-listings">
                        <i class="fas fa-search"></i>
                        <h3>Nu am găsit anunțuri</h3>
                        <p>
                            {% if search_query or current_category or current_city %}
                                Încearcă să modifici filtrele pentru a găsi mai multe rezultate.
                            {% else %}
                                Nu există anunțuri disponibile momentan.
                            {% endif %}
                        </p>
                        
                        <div class="mt-3">
                            {% if search_query or current_category or current_city %}
                                <a href="{% url 'listings:list' %}" class="btn btn-primary">
                                    <i class="fas fa-refresh"></i> Vezi toate anunțurile
                                </a>
                            {% endif %}
                            {% if user.is_authenticated %}
                                <a href="{% url 'listings:create' %}" class="btn btn-outline">
                                    <i class="fas fa-plus"></i> Adaugă primul anunț
                                </a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </main>
        </div>
    </div>
</div>
{% endblock %}