{% extends "base.html" %}
{% load static %}

{% csrf_token %}

{% block title %}{{ listing.title }} - Micu's Market{% endblock %}

{% block content %}


<!-- Listing Details -->
<section class="listing-detail">
    <div class="container">
        <div class="listing-content">
            <!-- Image Gallery -->
            <div class="image-gallery">
                {% if listing.images.all %}
                    <div class="main-image">
                        <img id="mainImage" src="{{ listing.main_image.url }}" alt="{{ listing.title }}">
                        {% if listing.is_featured %}
                            <div class="featured-badge">
                                <i class="fas fa-star"></i> Recomandat
                            </div>
                        {% endif %}
                    </div>
                    
                    {% if listing.images.count > 1 %}
                    <div class="image-thumbnails">
                        {% for image in listing.images.all %}
                        <img src="{{ image.image.url }}" 
                             alt="{{ image.alt_text }}" 
                             class="thumbnail {% if forloop.first %}active{% endif %}"
                             onclick="changeMainImage('{{ image.image.url }}', this)">
                        {% endfor %}
                    </div>
                    {% endif %}
                {% else %}
                    <div class="no-images">
                        <i class="fas fa-image"></i>
                        <p>Nu sunt disponibile imagini</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Listing Info -->
            <div class="listing-info">
                <div class="listing-header">
                    <h1>{{ listing.title }}</h1>
                    <div class="listing-meta">
                        <span class="price">{{ listing.price }} RON</span>
                        {% if listing.negotiable %}
                            <span class="negotiable">Negociabil</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="listing-details">
                    <div class="detail-item">
                        <i class="fas fa-folder"></i>
                        <span>Categorie:</span>
                        <strong>{{ listing.category.name }}</strong>
                    </div>
                    
                    <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Locație:</span>
                        <strong>{{ listing.city }}, {{ listing.county }}</strong>
                    </div>
                    
                    <div class="detail-item">
                        <i class="fas fa-certificate"></i>
                        <span>Stare:</span>
                        <strong>
                            {% if listing.condition == 'new' %}Nou
                            {% elif listing.condition == 'like_new' %}Ca nou
                            {% elif listing.condition == 'good' %}Bună
                            {% elif listing.condition == 'fair' %}Acceptabilă
                            {% else %}Folosit{% endif %}
                        </strong>
                    </div>
                    
                    <div class="detail-item">
                        <i class="fas fa-calendar"></i>
                        <span>Publicat:</span>
                        <strong>{{ listing.created_at|date:"d F Y" }}</strong>
                    </div>
                    
                    <div class="detail-item">
                        <i class="fas fa-eye"></i>
                        <span>Vizualizări:</span>
                        <strong>{{ listing.views_count }}</strong>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="listing-actions" style="position: static !important; opacity: 1 !important; display: flex !important; gap: 1rem !important;">
                    {% if user.is_authenticated and user != listing.owner %}
                        <a href="{% url 'chat:start_conversation' listing.slug %}" class="btn btn-primary">
                            <i class="fas fa-envelope"></i> Trimite mesaj
                        </a>
                    {% elif user == listing.owner %}
                        <a href="{% url 'listings:update' listing.slug %}" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Editează anunțul
                        </a>
                    {% else %}
                        <a href="{% url 'accounts:login' %}" class="btn btn-primary">
                            <i class="fas fa-envelope"></i> Trimite mesaj
                        </a>
                    {% endif %}
                    
                    {% if user.is_authenticated and user != listing.owner %}
                        <button id="favorite-detail-btn" class="{% if is_favorited %}favorited{% endif %}" 
                                data-listing="{{ listing.id }}" 
                                title="{% if is_favorited %}Elimină din favorite{% else %}Adaugă la favorite{% endif %}">
                            <i class="{% if is_favorited %}fas{% else %}far{% endif %} fa-heart"></i> 
                            <span>{% if is_favorited %}În favorite{% else %}Adaugă la favorite{% endif %}</span>
                        </button>
                    {% endif %}
                    <button class="btn btn-secondary share-btn">
                        <i class="fas fa-share-alt"></i> Partajează
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Description -->
        <div class="description-section">
            <h2><i class="fas fa-info-circle"></i> Descriere</h2>
            <div class="description-content">
                {{ listing.description|linebreaks }}
            </div>
        </div>
        
        <!-- Seller Info -->
        <div class="seller-section">
            <h2><i class="fas fa-user"></i> Vânzător</h2>
            <div class="seller-info">
                <div class="seller-avatar">
                    {% if listing.owner.userprofile.avatar %}
                        <img src="{{ listing.owner.userprofile.avatar.url }}" alt="{{ listing.owner.get_full_name }}">
                    {% else %}
                        <div class="default-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="seller-details">
                    <h3>{{ listing.owner.get_full_name|default:listing.owner.username }}</h3>
                    <p class="member-since">Membru din {{ listing.owner.date_joined|date:"F Y" }}</p>
                    <div class="seller-stats">
                        <span><i class="fas fa-clipboard-list"></i> {{ listing.owner.userprofile.total_listings }} anunțuri</span>
                        <span><i class="fas fa-star"></i> {{ listing.owner.userprofile.rating|floatformat:1 }} rating</span>
                    </div>
                </div>
                <div class="seller-actions">
                    <button class="btn btn-outline">
                        <i class="fas fa-envelope"></i> Trimite mesaj
                    </button>
                    <a href="{% url 'listings:list' %}?seller={{ listing.owner.username }}" class="btn btn-outline">
                        <i class="fas fa-list"></i> Vezi toate anunțurile
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Similar Listings -->
{% if similar_listings %}
<section class="similar-listings">
    <div class="container">
        <h2><i class="fas fa-th"></i> Anunțuri similare</h2>
        <div class="listings-grid">
            {% for similar in similar_listings %}
            <a href="{% url 'listings:detail' similar.slug %}" class="listing-card">
                <div class="listing-image">
                    {% if similar.images.first %}
                        <img src="{{ similar.images.first.image.url }}" alt="{{ similar.title }}">
                    {% else %}
                        <div class="no-image">
                            <i class="fas fa-image"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="listing-content">
                    <h3>{{ similar.title }}</h3>
                    <p class="price">{{ similar.price }} RON</p>
                    <p class="location">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ similar.city }}, {{ similar.county }}
                    </p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/listings.css' %}">
<style>
/* Design elegant pentru butonul de favorite - NU MAI PĂTRATE! */
#favorite-detail-btn {
    background: transparent;
    border: none;
    color: #64748b;
    padding: 10px 15px;
    border-radius: 25px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.2s ease;
    cursor: pointer;
    text-decoration: none;
    border: 2px solid #e2e8f0;
    min-height: 40px;
}

#favorite-detail-btn:hover {
    background: #fef2f2;
    border-color: #fca5a5;
    color: #ef4444;
}

#favorite-detail-btn.favorited {
    background: #fef2f2;
    border-color: #ef4444;
    color: #ef4444;
}

#favorite-detail-btn.favorited:hover {
    background: #fecaca;
    border-color: #dc2626;
    color: #dc2626;
}

#favorite-detail-btn i {
    font-size: 16px;
}

#favorite-detail-btn span {
    font-weight: 500;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/favorites.js' %}"></script>
<script>

</script>
{% endblock %}
